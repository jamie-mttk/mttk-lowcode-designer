# MTTK低代码引擎和MTTK Open BI用户手册

[English User Manual](https://github.com/jamie-mttk/mttk-vue-wrap/blob/master/UserManual.md)

## 如何使用

### 访问URL

只需使用现代浏览器即可使用此系统！默认URL为http://%your server ip%:8825

### 登录

如果尚未登录或登录令牌已过期，登录屏幕将自动显示。
输入用户名和密码。默认帐户是admin/123456

![登录](https://github.com/jamie-mttk/mttk-lowcode-designer/blob/master/src/screenCaptures/login.png)

### 应用程序

登录后，将显示应用程序列表屏幕。在这里，您可以添加新应用程序。

![应用程序列表](https://github.com/jamie-mttk/mttk-lowcode-designer/blob/master/src/screenCaptures/app_list.png)

以下是现有应用程序的操作。

|操作|描述|
|---|---|
|设计|开发人员可以编辑应用程序下的资源，如菜单、页面、JDBC连接、数据模型|
|启动|最终用户可以查看按菜单/页面分组的图表|
|设置|应用程序属性，如名称、图标等|
|删除|删除应用程序及所有关联资源|
|数据授权|授权应用程序访问权限|

### JDBC连接

标准的JDBC配置。有关JDBC驱动程序，请参阅下面的“DB支持”章节。

### 数据模型

这是一个树/星形架构，每个节点是从左侧面板拖动的表/视图或SQL。
对于每个节点，您可以编辑基本信息/关系并选择列。

![数据模型](https://github.com/jamie-mttk/mttk-lowcode-designer/blob/master/src/screenCaptures/data_model.png)

#### 表达式字段

这是数据库表中不存在的字段。以下是一些关键点：

- 表达式是目标数据库支持的原始SQL表达式。引擎只是将表达式添加到生成的SQL中。
- 为了避免列冲突，建议在列之前放置表别名。例如，使用“order_details.unitPrice*order_details.quantity”而不是“unitPrice*order_quantity-discount”。表别名设置在表信息屏幕中。
- 实体应设置为确定表达式字段中的列来自哪些实体。因此，如果使用表达式字段，则引擎将自动将这些实体添加到SQL FROM列表中。

### 菜单和页面

菜单用于组织页面。
页面有两种布局策略，一种是flex，另一种是absolute。它们可以简单地认为是CSS“display:flex”和“display:absolute”。
推荐使用Flex策略，图表将自动扩展以适应屏幕宽度。
Absolute策略具有固定的宽度和高度，但可以配置为填充屏幕宽度/高度或两者。它非常适用于构建仪表板/大屏幕以全屏模式显示。

![设计](https://github.com/jamie-mttk/mttk-lowcode-designer/blob/master/src/screenCaptures/design.png)

### 页面设计

#### UI

![页面设计](https://github.com/jamie-mttk/mttk-lowcode-designer/blob/master/src/screenCaptures/single_page.png)

顶部区域显示页面名称和一些按钮。

左侧面板有调色板和组件树。调色板包含所有可以拖动到主面板的组件。组件树显示页面的组件结构，组件可以直接在主面板内/外移动。

右侧面板是属性编辑器。如果未选择任何组件（单击主面板中的任何空白区域或单击页面标题），将显示页面配置；否则将显示所选组件的属性。

中间区域是显示页面组件的主面板。支持上/下移动组件或内部/外部面板。在绝对模式中，支持调整大小/更改位置；在flex模式中，支持更改高度。

#### 组件

左侧面板中的组件可以通过插件机制添加，详细信息请参阅开发人员手册。

在主面板中，组件可以通过容器组件进行组织。典型组件包括标签/布局/卡片等。

BI下的组件是与BI相关的组件，属性编辑器支持数据模型/基本/显示。数据模型选项卡配置使用的数据模型和从数据模型中检索数据的逻辑，详细信息如下。基本选项卡配置图表的行为，例如主题/标题等。显示选项卡用于设置图表的CSS样式。

### 属性编辑器-数据

某些组件，例如输入/表单需要设置数据。设置的数据类型必须与所需的数据类型匹配。数据可以通过以下多种模式设置

|模式|描述|
|---|---|
|数据|在数据编辑器中定义的数据。“数据路径”用于从数据中检索子集。读取和写入。|
|计算|在计算编辑器中定义的计算。读取和写入。|
|方法|方法的返回值作为数据，只读。|
|固定|固定值，将尝试符合所需的数据类型。只读。|

### 属性编辑器-事件

事件可以定义组件发出事件后的行为。事件名称可以从列表中选择或手动输入，然后按Enter键。
支持多种模式处理事件

|模式|描述|
|---|---|
|脚本|直接调用脚本。第一个参数是页面上下文，第二个是包装器上下文，其他是事件原始参数。页面上下文和包装上下文请参阅后面的“高级主题”章节|
|方法|调用方法编辑器中定义的方法。参数定义与上面的脚本相同。|
|API|直接调用API编辑器中定义的API|

### BI的页面设计

#### 配置数据模型 

对于每个配置，将鼠标移动到问号图标可显示所选图表的含义

|配置|描述|
|---|---|
|维度|通常可以视为X轴的值|
|度量|通常可以视为Y轴的值|
|钻取|仅由某些图表支持，请参阅“钻取”章节|
|筛选|仅为所选组件筛选数据模型|
|行限制|限制从服务器返回的行数|
|分页|参考分页|
|自动刷新|自动重新加载数据并重新绘制图表，需要重新进入页面以生效|

#### SQL生成

BI引擎将根据配置生成SQL。单击“显示SQL”可显示生成的SQL。大致逻辑如下。

1. 查找所有维度/度量/筛选的列来自的所有实体（表/视图/SQL）。
2. 连接找到的所有实体。
3. 将维度/度量的列追加到SELECT字段列表。
4. 如果有筛选，则生成WHERE筛选条件
5. 如果度量不为空，则将所有维度的列追加到GROUP BY。这是维度和度量之间的唯一区别。

#### 钻取

请参阅示例项目的“钻取演示”。例如，要显示销售数据，第一个可以是国家，第二级可以是城市，第三级可以是客户，钻取意味着通过单击适当数据来展开/收缩。

#### 筛选组件

用于实时在视图模式下筛选数据。逻辑是基于数据模型的。所有具有与筛选组件相同数据模型的图表将自动进行筛选。

#### 分页

服务器分页意味着在服务器端进行分页，仅返回所需的行。

客户端分页意味着从服务器返回所有数据，然后在浏览器内部进行分页。

## 认证和授权

### 术语

|名称|描述|
|---|---|
|资源|授予权限的对象。例如，应用程序、菜单、页面、数据模型等。|
|帐户|使用该系统的用户。|
|角色|定义对资源的操作。一个帐户可以拥有多个角色。|
|帐户组|组用于简化授权。与资源所有者具有相同用户组的用户可以获取对资源的访问/编辑/删除权限【也可以手动撤销】。一个帐户可以属于多个组。|
|资源所有者|每个资源都有一个或多个所有者。默认情况下，所有者是资源创建者。|

### 资源权限

每种资源类型都有以下权限可授予。

|名称|描述|
|---|---|
|访问|用户可以查看资源而不做任何更改|
|添加|创建新资源|
|编辑|编辑经授权的资源|
|删除|删除经授权的资源|
|授权|更改资源授权|
|完全控制|对所有资源（此类型）拥有完全控制权限，即使未明确授予权限也是如此|
|全部读取|可以访问所有资源（此类型），即使未明确授予权限也是如此|

### 管理屏幕

帐户
![帐户](https://github.com/jamie-mttk/mttk-lowcode-designer/blob/master/src/screenCaptures/account.png)

帐户组
![帐户组](https://github.com/jamie-mttk/mttk-lowcode-designer/blob/master/src/screenCaptures/account_group.png)

角色
![帐户](https://github.com/jamie-mttk/mttk-lowcode-designer/blob/master/src/screenCaptures/role.png)

这是授权单个资源的屏幕
![帐户](https://github.com/jamie-mttk/mttk-lowcode-designer/blob/master/src/screenCaptures/data_auth.png)

### 规则

以下规则用于确定帐户是否被授权访问给定资源

- 如果资源（例如页面、数据模型）位于应用程序下，则应授权该应用程序
- 如果帐户的任何角色对给定资源类型具有“完全控制”权限，则帐户可以访问/添加/编辑/删除/授权该资源类型的任何资源，而无需明确授权
- 如果帐户的任何角色对给定资源类型具有“全部读取”权限，则帐户可以访问该资源类型的任何资源，而无需明确授权。帐户可能已经明确授予添加/编辑/删除/授权权限，遵循以下规则。
- 如果帐户的角色没有给定的授权，例如page_edit（功能授权）。即使某些页面已明确授予编辑授权（数据授权），帐户也无法编辑任何页面。换句话说，功能授权和数据授权都是强制性的。
- 数据授权
  第一资源所有者对资源拥有完全控制权；第二所有者组具有访问/编辑/删除权限（可以手动撤销）；任何帐户组/帐户可以根据需求手动授予。

## 其他

### 数据库支持

到目前为止，支持以下数据库，更多数据库将在以后支持。

- MySQL
- PostgreSQL
- Oracle
- DB2
- Microsoft SQL Server
- Informix
  
支持数据库包括两部分：

- 数据库方言是一个处理标准SQL中不包含的功能的Java类。
- JDBC驱动程序。最新版本的JDBC驱动程序已打包到lowcode.jar中。如果与您的DB不匹配，则可能需要手动更新到/BOOT_INF/lib中的lowcode.jar
- 
由于后端将进行重新设计，因此DB支持将稍后可插拔。

### 性能

性能取决于目标数据库服务器中的SQL执行时间。因此，通过分析生成的SQL来调整性能。

### 插件开发

请参阅开发人员手册。

### 系统架构

下面是描述图表如何呈现的流程
![架构](https://github.com/jamie-mttk/mttk-bi/blob/master/src/architecture.png)

## 已知问题

### 后端优化

后端服务器尚未完全定义，将在以后进行优化。

- 数据库支持（方言/JDBC驱动程序）不可插拔
- 低代码引擎插件，例如BI插件不可插拔
  
### TypeScript支持

尽管所有前端代码都是.ts文件，但实际上它们是不符合TypeScript的JS。